@using HRM.DAL.Models;
@using HRM.DAL.Util;
@using PagedList.Mvc;
@model PagedList.IPagedList<admin_hrm_leave_request>
@{
    ViewBag.Title = "LeaveList";
}

<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        <h2>Leave List</h2>
        <ol class="breadcrumb">
            <li>
                <a href="@Url.Action("Noticeboard","Admin")">Administration</a>
            </li>
            <li>
                <a>HRM</a>
            </li>
            <li>
                <a>Leave</a>
            </li>
            <li class="active">
                <strong>Leave List</strong>
            </li>
        </ol>
    </div>
    <div class="col-lg-2">

    </div>
</div>


<div class="wrapper wrapper-content  animated fadeInRight">
    <div class="row">
        <div class="col-sm-12">



            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>Leave List </h5>

                </div>
                <div class="ibox-content">

                    <form method="get" action="@Url.Action("LeaveList","Leave")">
                        <div class="row">
                            <div class="col-lg-4">
                                <div class="form-group" id="data_1">
                                    <label class="font-noraml">From Date</label>
                                    <div class="input-group date">
                                        <span class="input-group-addon"><i class="fa fa-calendar"></i></span><input id="start_date" name="start_date" type="text" readonly class="form-control">
                                    </div>
                                </div>
                            </div>

                            <div class="col-lg-4">
                                <div class="form-group" id="data_1">
                                    <label class="font-noraml">To Date</label>
                                    <div class="input-group date">
                                        <span class="input-group-addon"><i class="fa fa-calendar"></i></span><input id="end_date" name="end_date" type="text" readonly class="form-control">
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="form-group" id="data_1">
                                    <label class="font-noraml">Employee</label>
                                    <select id="e6" name="employee"></select>
                                </div>
                            </div>

                        </div>
                        <div class="row">
                            <div class="col-lg-12">
                                <label> <input type="checkbox"  class="i-checks" onclick="$('.i-checks').prop('checked', true);" /> ALL </label>&nbsp;
                                <label> <input type="checkbox"  name="category" value="1"   class="i-checks" /> Pending Approval </label>&nbsp;
                                <label> <input type="checkbox"  name="category"  value="2" class="i-checks" /> Scheduled </label>&nbsp;
                                <label> <input type="checkbox"  name="category" value="3"  class="i-checks" /> Taken </label>&nbsp;
                                <label> <input type="checkbox"  name="category" value="-1" class="i-checks" /> Rejected </label>&nbsp;
                                <label> <input type="checkbox" name="category" value="0" class="i-checks" /> Cancelled </label>&nbsp;
                                <button class="btn btn-default btn-sm pull-right" type="submit">Search <i class="fa fa-search"></i></button>
                            </div>
                        </div>
                    </form>
                    <div class="table-responsive">

                        <form method="post" action="@Url.Action("LeaveList","Leave")">



                           @* <button type="submit" class="btn btn-sm btn-outline btn-info pull-right">Save</button>*@
                            <table class="table table-striped table-bordered table-hover">
                                <thead>
                                    <tr>
                                        <th>Employee</th>
                                        <th>Date</th>
                                        <th>Leave Type</th>
                                        <th>Leave Balance(Days)</th>
                                        <th>Number of Days</th>
                                        <th>Status</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @if (Model.Any())
                                    {
                                        foreach (var request in Model)
                                        {
                                            var comment = "";
                                            if (request.admin_hrm_leave_request_comment.Count() > 0)
                                            {
                                                comment = request.admin_hrm_leave_request_comment.FirstOrDefault().comments;
                                            }
                                            var entitlement = request.admin_hrm_employee.admin_hrm_leave_entitlement.FirstOrDefault(e => e.leave_type_id == 1);
                                            <tr>
                                                <td>@string.Format("{0} {1} {2}", request.admin_hrm_employee.emp_firstname, request.admin_hrm_employee.emp_lastname, request.admin_hrm_employee.emp_middle_name)</td>
                                                <td>@request.leave_start_date.ToString("yyyy-MM-dd")</td>
                                                <td>@request.admin_hrm_leave_type.name</td>
                                                @if (entitlement != null)
                                                {
                                                    <td>@string.Format("{0}", entitlement.no_of_days - entitlement.days_used)</td>
                                                }
                                                else
                                                {
                                                    <td></td>
                                                }
                                                <td>@request.admin_hrm_leave.Count()</td>
                                                <td>@OptionUtil.GetLeaveStatus(request.admin_hrm_leave.ToList())</td>
                                                <td>
                                                    <div class="row">
                                                        @*<div class="col-lg-6">
                                                            <select class="form-control" name="@request.id">
                                                                <option value="-2">Select action</option>
                                                                <option value="3">Approve</option>
                                                                <option value="0">Cancel</option>
                                                                <option value="-1">Reject</option>
                                                            </select>
                                                        </div>*@
                                                        <div class="col-lg-12">
                                                            @*<button class="btn btn-xs btn-warning btn-outline" type="button" data-toggle="tooltip" title="View comment" onclick="show_comment('c_@request.id')">Comment <i class="fa fa-comment-o"></i></button>*@
                                                            &nbsp;<a class="btn btn-xs btn-info" data-toggle="tooltip" title="Leave details" href="@Url.Action("LeaveDetails","Leave",new { request_id = request.id })" onclick="">Details <i class="fa fa-info"></i></a>
                                                        </div>
                                                    </div>

                                                    <input type="hidden" value="@comment" id="c_@request.id" />


                                                </td>
                                            </tr>
                                    }

                                }
                                </tbody>

                            </table>

                        </form>
                        <div id='Paging' style="text-align:center">
                            Page @(Model.PageCount < Model.PageNumber ? 0 : Model.PageNumber)
                            of @Model.PageCount

                            @Html.PagedListPager(Model, page => Url.Action("leavelist", new { page }))
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal inmodal" id="mdComment" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
       
            <div class="modal-content animated flipInY">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h4 class="modal-title">New User</h4>
                    <small class="font-bold">Add an employee as a user</small>
                </div>
                <div class="modal-body">

                    <p id="comment"></p>
             





                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-white" data-dismiss="modal">Close</button>
                   
                </div>
            </div>

     
    </div>
</div>



@section scripts{
<script src="~/Content/libs/datapicker/bootstrap-datepicker.js"></script>
<script src="~/Content/libs/dataTables/datatables.min.js"></script>
    <script src="~/Content/libs/iCheck/icheck.min.js"></script>
    <script src="~/Scripts/custom_fns/base.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/js/select2.min.js"></script>

    <script>

        $(document).ready(function () {


            $('.i-checks').iCheck({
                checkboxClass: 'icheckbox_square-green',
                radioClass: 'iradio_square-green'
            });

            $('#e6').select2({
                placeholder: 'Employee',
                ajax: {
                    url: function (params) {
                        return baseUrl() + "employeeapi/getsearch/" + params.term;
                    },
                    dataType: 'json',
                    quietMillis: 100,

                    processResults: function (data) {
                        return {
                            results: $.map(data, function (obj) {
                                return { id: obj.id, text: obj.name };
                            })
                        };
                    }

                }
            });

            $('#data_1 .input-group.date').datepicker({
                format: 'yyyy-mm-dd',
                todayBtn: "linked",
                keyboardNavigation: false,
                forceParse: false,
                calendarWeeks: true,
                autoclose: true
            });



        });

        function show_comment(control) {
            $("#comment").text($("#" + control).val());
        }


    </script>
}



@section styles{

    <link href="~/Content/libs/datapicker/datepicker3.css" rel="stylesheet">
    <link href="~/Content/libs/dataTables/datatables.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/css/select2.min.css" rel="stylesheet" />
    <link href="~/Content/libs/iCheck/custom.css" rel="stylesheet" />

    <style>
        .select2-close-mask {
            z-index: 2099;
        }

        .select2-dropdown {
            z-index: 3051;
        }

        .select2 {
            width: 100% !important;
        }
        label{
            font-weight:normal
        }
    </style>

}






