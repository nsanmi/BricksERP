@using Microsoft.AspNet.Identity;
@using Microsoft.AspNet.Identity.EntityFramework;
@using OnePortal.Models;
@using HRM.DAL.Models;
@using HRM.DAL.Util;
@using iTextSharp.text
@using PagedList.Mvc;
@using OnePortal.Models.ViewModels;
@model PagedList.IPagedList<admin_announcement>
@{
    ViewBag.Title = "Noticeboard";
    ApplicationDbContext context = new ApplicationDbContext();
    var UserManager = new UserManager<ApplicationUser>(new UserStore<ApplicationUser>(context));
    var user = UserManager.FindByName(User.Identity.Name);
    var employee = OptionUtil.GetEmployee(user.Id);
    var month_celebrants = (IQueryable<admin_hrm_employee>)ViewBag.month_celebrants;
    var leaves = (IQueryable<admin_hrm_leave_request>)ViewBag.leaves;
    var coreValues = (List<CoreValues>)ViewBag.coreValues;
    var birthdaycelebrant = new List<admin_hrm_employee>();
}

<div class="wrapper wrapper-content">
    <div class="row animated fadeInDown">
        <div class="col-lg-12" style="background-color: #1ab29445;">
            <div class="col-md-3" style="margin-top: 10px;">
                <div class="">
                    <div class="ibox-content">
                        <a href="https://brickspoints.com" class="btn btn-primary glowing">Ethics Hotline</a><h4 style="font-weight: bold">Brickspoint MISSION</h4>
                        <p class="card-text identifyingClass">To serve the public good through our service.</p>

                        <h4 style="font-weight: bold">BRICKSPOINT VISION</h4>
                        <p class="card-text identifyingClass" style="text-overflow: ellipsis; white-space: nowrap; overflow: hidden;">The Hotel will excel as a pre-eminent institution in its missions to address real-world issues affecting the human condition, provide excellent dervices and serve the public with dedication to improve public good. The Hotel will become a dominant economic leader of the region through innovation, entrepreneurship, philanthropy, and interdisciplinary and inter-professional teamwork. The Hotel will extend its reach with hallmark local and global</p>
                        <a class="btn btn-primary" data-toggle="modal" data-target="#modalVision" data-id="">Read more</a>
                    </div>
                </div>
            </div>

            <div class="col-md-9 col-sm-12 text-center">
                <div>
                    <h3 class="card-title" style="color:#ffffff">
                       CORE VALUES
                    </h3>
                    <h5 style="color:#ffffff">Our seven core values guide our operating philosophy, and commitment to our constituents and clients, while supporting our dedication to global enhancement and social progress.</h5>

                    <div class="m-l-lg m-r-lg" id="coreValueSlider">

                        @foreach (var core_v in coreValues)
                        {
                            <div>
                                <div class="ibox-content">
                                    <div class="card">
                                        <div class="card-body">
                                            <h5 class="card-title">@core_v.title</h5>
                                            <div class="card-text" style="">
                                                @Html.Raw(@core_v.definition)
                                            </div>
                                            <a id="comest" class="btn btn-primary slideButtonReadMore" data-toggle="modal" data-target="#coreValuesModal" data-id="@core_v.title">Read more</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@*<div class="row border-bottom white-bg dashboard-header" style="height:280px;">

        <div class="col-md-3">
            <h4 style="font-weight: bold">Mission</h4>
            <p class="card-text identifyingClass">To improve the human condition and serve the public good through education, research, clinical care, and service.</p>
            <br/>
            <h4 style="font-weight: bold">Vision</h4>
            <p class="card-text identifyingClass" style="text-overflow: ellipsis; white-space: nowrap; overflow: hidden;">The University will excel as a pre-eminent institution in its missions to educate professionals, conduct research that addresses real-world issues affecting the human condition, provide excellent clinical care and practice, and serve the public with dedication to improve health, justice, and the public good. The University will become a dominant economic leader of the region through innovation, entrepreneurship, philanthropy, and interdisciplinary and inter-professional teamwork. The University will extend its reach with hallmark local and global</p>
            <a href="#" class="btn btn-primary" data-toggle="modal" data-target="#modalVision" data-id="">Read more</a>
        </div>

        <div class="col-md-9 col-sm-12 text-center">
            <h3 class="text-center" >
                MGIC CORE VALUES
            </h3>


        <div class="m-l-lg m-r-lg" id="coreValueSlider">

            @foreach (var core_v in coreValues)
            {
                <div>
                    <div class="ibox-content">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">@core_v.title</h5>
                                <p class="card-text identifyingClass" style="text-overflow: ellipsis; white-space: nowrap; overflow: hidden;">
                                    @core_v.defination;
                                </p>
                                <a href="#" id ="comest" class="btn btn-primary" data-toggle="modal" data-target="#coreValuesModal" data-id="@core_v.title">Read more</a>
                            </div>
                        </div>
                    </div>
                </div>
            }


        </div>

        </div>


        <footer id="footer"></footer>
    </div>*@

<div id="coreValuesModal" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Core Value - <strong id="Comment_Header"></strong></h4>
            </div>
            <div class="modal-body">
                <p id="Comment_Container"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>

    </div>
</div>

<div id="modalVision" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title text-center">Brickspoint Vision</h4>
            </div>
            <div class="modal-body">
                <p id="Comment_Container"> The Hotel will excel as a pre-eminent institution in its missions to address real-world issues affecting the human condition, provide excellent dervices and serve the public with dedication to improve public good. The Hotel will become a dominant economic leader of the region through innovation, entrepreneurship, philanthropy, and interdisciplinary and inter-professional teamwork. The Hotel will extend its reach with hallmark local and global </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>

    </div>
</div>

<div class="wrapper wrapper-content">
    <div class="row animated fadeInDown">
        <div class="col-lg-4">
            <table class="table table-striped table-bordered table-hover" style="background-color:#ffffff">
                <thead>
                    <tr>
                        <th colspan="4" style="text-align:center">Leave Schedule</th>
                    </tr>
                </thead>
                <tbody>
                    @if (leaves.Any())
                    {
                        foreach (var request in leaves.Where(e => System.Data.Entity.DbFunctions.AddDays(e.leave_start_date, -30) <= DateTime.Now && System.Data.Entity.DbFunctions.AddDays(e.leave_start_date, 7) >= DateTime.Now))
                        {
                            string pic = "/Content/images/profile_images/" + request.admin_hrm_employee.user_id + ".jpg";
                            if (!File.Exists(Server.MapPath(pic)))
                            { pic = "/Content/images/a4.jpg"; }
                            var entitlement = request.admin_hrm_employee.admin_hrm_leave_entitlement.FirstOrDefault(e => e.leave_type_id == 1);
                            <tr>
                                <td class="client-avatar"><img alt="image" src="@pic"> </td>
                                <td>@string.Format("{0} {1} {2}", request.admin_hrm_employee.emp_firstname, request.admin_hrm_employee.emp_lastname, request.admin_hrm_employee.emp_middle_name)</td>
                                <td><small><i>@request.leave_start_date.ToString("yyyy-MM-dd")</i> <strong>to</strong> <i>@request.admin_hrm_leave.LastOrDefault().date.Value.ToString("yyyy-MM-dd")</i> </small></td>
                                @*<td>@request.admin_hrm_leave_type.name</td>*@

                                <td>@request.admin_hrm_leave.Count()</td>
                            </tr>
                        }
                    }
                </tbody>

            </table>
        </div>

        <div class="col-lg-4">

            @if (month_celebrants.Any())
            {
                foreach (var celebrant in month_celebrants.Where(e => e.emp_birthday.Value.Day == DateTime.Now.Day && e.emp_birthday.Value.Month == DateTime.Now.Month && e.user_id != null))
                {
                    string pic = "/Content/images/profile_images/" + celebrant.user_id + ".jpg";
                    if (!File.Exists(Server.MapPath(pic)))
                    { pic = "/Content/images/a4.jpg"; }

                    birthdaycelebrant.Add(celebrant);
                    <div class="widget-head-color-box navy-bg p-lg text-center" style="margin-top:-2px">
                        <div class="m-b-md">
                            <h2 class="font-bold no-margins">
                                Happy Birthday @string.Format("{0}", celebrant.emp_firstname) !!!
                            </h2>
                            <small>
                                @if (celebrant.admin_hrm_emp_job_record.admin_hrm_lkup_job_title != null)
                                {
                                    <span>@celebrant.admin_hrm_emp_job_record.admin_hrm_lkup_job_title.job_title</span>
                                }
                            </small>
                        </div>
                        <img src="@pic" style="height:100px" class="img-circle circle-border m-b-md" alt="profile">

                    </div>
                    <div class="widget-text-box">
                        <h4 class="media-heading">@string.Format("{0} {1}", celebrant.emp_lastname, celebrant.emp_firstname)</h4>
                        <p>We like to show we appreciate your kindness and support every day — doubly so on your birthday. Have a truly special day. Enjoy !!!</p>
                        <div class="text-right">

                        </div>
                    </div>


                }
            }


            <div class="row">
                <div class="col-lg-12">
                    @if (month_celebrants.Any())

                    {
                        <table class="table table-striped table-hover table-bordered" id="tb_employees" style="background-color:#ffffff" data-page-length='15'>
                            <thead>
                                <tr>
                                    <th colspan="4" style="text-align:center">Celebrities of the Month</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var celebrant in month_celebrants.Where(e => e.user_id != null))
                                {
                                    string pic = "/Content/images/profile_images/" + celebrant.user_id + ".jpg";
                                    if (!File.Exists(Server.MapPath(pic)))
                                    { pic = "/Content/images/a4.jpg"; }

                                    <tr>

                                        <td class="client-avatar"><img alt="image" src="@pic"> </td>
                                        <td>@string.Format("{0} {1}", celebrant.emp_lastname, celebrant.emp_firstname)</td>
                                        <td>
                                            @if (celebrant.admin_hrm_emp_job_record.admin_hrm_lkup_job_title != null)
                                            {
                                                <small>@celebrant.admin_hrm_emp_job_record.admin_hrm_lkup_job_title.job_title</small>
                                            }
                                        </td>
                                        <td>
                                            @celebrant.emp_birthday.Value.ToString("MMMM, dd")
                                        </td>

                                    </tr>

                                }
                            </tbody>
                        </table>
                    }
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>Notes</h5>
                    <div class="ibox-tools">
                        @*<span class="label label-warning-light pull-right">10 Messages</span>*@
                        <button class="btn btn-circle btn-default" onclick="show_editor()" type="button"><i class="fa fa-plus"></i></button>
                    </div>
                </div>
                <div class="ibox-content">

                    <div>
                        <div class="chat-form" id="div_chat" style="display:none">
                            <form role="form">
                                <div class="form-group" style="border:1px solid #ccc;">
                                    <div class="summernote" name="message">
                                    </div>
                                    @*<textarea class="form-control" placeholder="Message"></textarea>*@
                                </div>
                                <div class="text-right">
                                    <button type="button" onclick="close_editor()" class="btn btn-sm btn-primary m-t-n-xs"><strong>Send message</strong></button>
                                </div>
                            </form>
                        </div>

                        <div class="pre-scrollable" style="max-height:600px">

                            <div class="feed-activity-list">

                                @if (Model.Any())
                                {
                                    foreach (var announcement in Model)
                                    {
                                        string pic = "/Content/images/profile_images/" + announcement.admin_hrm_employee.user_id + ".jpg";
                                        if (!File.Exists(Server.MapPath(pic)))
                                        { pic = "/Content/images/a4.jpg"; }

                                        <div class="feed-element">
                                            <a href="profile.html" class="pull-left">
                                                <img alt="image" class="img-circle" src="@pic">
                                            </a>
                                            <div class="media-body ">
                                                <small class="pull-right"></small>
                                                <strong>@string.Format("{0} {1}", announcement.admin_hrm_employee.emp_lastname, announcement.admin_hrm_employee.emp_firstname)</strong> @MvcHtmlString.Create(WebUtility.HtmlDecode(announcement.message))   <br>
                                                <small class="text-muted">@announcement.created_at.ToString("MMM dd, yyyy HH:mm tt")</small>
                                                <div class="actions">
                                                    @* <a class="btn btn-xs btn-white"><i class="fa fa-edit"></i> Edit </a>*@
                                                    @if (announcement.created_by == employee.emp_number || User.IsInRole("admin"))
                                                    {
                                                        <a href="@Url.Action("DeletePost","Admin",new { id = announcement.id })" class="btn btn-xs btn-danger"><i class="fa fa-trash"></i> Delete</a>
                                                    }

                                                </div>
                                            </div>
                                        </div>
                                    }
                                }


                            </div>
                        </div>
                        <div id='Paging' style="text-align:center">
                            Page @(Model.PageCount < Model.PageNumber ? 0 : Model.PageNumber)
                            of @Model.PageCount

                            @Html.PagedListPager(Model, page => Url.Action("Noticeboard", new { page }))
                        </div>

                    </div>

                </div>
            </div>

        </div>
    </div>
</div>
@if (birthdaycelebrant.Select(m => m.user_id).Contains(employee.user_id))
{
    <div id="follower">Happy Birthday @(employee.emp_lastname + " " + employee.emp_firstname)</div>
}


@section scripts{

    <script src="~/Content/libs/iCheck/icheck.min.js"></script>
    <script src="~/Scripts/custom_fns/base.js"></script>
    <script src="~/Content/libs/summernote/summernote.min.js"></script>
    <script src="~/Content/libs/jquery/plugins/toastr/toastr.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.6.0/slick.min.js"></script>

    <script>


        $(document).ready(function () {

            $('.i-checks').iCheck({
                checkboxClass: 'icheckbox_square-green',
                radioClass: 'iradio_square-green'
            });

            $(document).on("click", ".slideButtonReadMore", function () {
                //$(".modal-body #Comment_Container").text("");
                var myImageId = $(this).data('id');
                var arrayOfArrays = JSON.parse('@Html.Raw(Json.Encode(coreValues))');
                var bodyText = "";
                for (var i = 0; i < arrayOfArrays.length; i++) {
                    if (arrayOfArrays[i].title === myImageId) {
                        bodyText = arrayOfArrays[i].body;
                    }
                }
                $(".modal-body #Comment_Container").html(bodyText);
                $(".modal-header #Comment_Header").text(myImageId);
            });
        });

        function show_editor() {
            $("#div_chat").show();
            $('.summernote').summernote({

            });
        }

        function close_editor() {
            var aHTML = $('.summernote').code();

            $.ajax({
                url: baseUrl() + 'announcement/post',
                method: "POST",
                data: JSON.stringify({ message: aHTML }),
                success: function() {
                    window.location.reload(true);
                    //$("#div_chat").hide();
                    //$('.summernote').destroy();
                }
            });
        }

        $(document).ready(function () {

            $("#coreValueSlider").slick({
                infinite: true,
                dots: true,
                autoplay: true,
                autoplaySpeed: 12000,
                centerMode: true,
                slidesToShow: 2
                /*,
                speed: 300,
                */
            });
            //$('.slick-slider').on('click', '.slick-slide', function () {
            //    alert($(this).text());
            //});
        });
    </script>
    <script>
        $(document).ready(function () {
            //var enablePagination = false;
            setTimeout(function () {
                toastr.options = {
                    closeButton: true,
                    progressBar: true,
                    showMethod: 'slideDown',
                    positionClass: "toast-bottom-left",
                    //positionClass: enablePagination ? "toast-bottom-left" : "toast-top-right",
                    timeOut: 400000
                };
                toastr.success(`
    <h3>Welcome</h3>
    <p>Tell us about your experience on our ERP in the Notes section of this page</p>
    `, 'ERP Attention');
            },
                2);
        }
        );

        var mouseX = 0, mouseY = 0;
        $(document).mousemove(function (e) {
            mouseX = e.pageX;
            mouseY = e.pageY;
        });

        // cache the selector
        var follower = $("#follower");
        var xp = 0, yp = 0;
        var loop = setInterval(function () {
            // change 12 to alter damping higher is slower
            xp += (mouseX - xp) / 6;
            yp += (mouseY - yp) / 6;
            follower.css({ left: xp, top: yp });

        }, 30);
    </script>
}



@section styles{
    <style>
        .wrapper-content {
            padding: 10px 10px 10px !important;
        }

        #follower {
            position: absolute;
            background-color: #b21a75c7;
            color: white;
            padding: 10px;
            border-radius: 5px;
        }
    </style>

    <link href="~/Content/libs/iCheck/custom.css" rel="stylesheet" />
    <link href="~/Content/libs/summernote/summernote.css" rel="stylesheet" />
    <link href="~/Content/libs/summernote/summernote-bs3.css" rel="stylesheet" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/jquery.slick/1.6.0/slick.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/jquery.slick/1.6.0/slick-theme.css">
    <link href="~/Content/css/toastr.min.css" rel="stylesheet" />
    <style>
        #toast-container > .toast-success {
            background-image: none !important;
        }

        .toast-success {
            background-color: #000000;
            width: 50% !important;
        }

        .slick-prev:before, .slick-next:before {
            color: #ffffff !important;
        }
        .glowing {
            float: right;
            -webkit-animation: glowing 1500ms infinite;
            -moz-animation: glowing 1500ms infinite;
            -o-animation: glowing 1500ms infinite;
            animation: glowing 1500ms infinite;
        }
        @@-webkit-keyframes glowing {
        0% { background-color: #1ab394; -webkit-box-shadow: 0 0 3px #1ab394; }
        50% { background-color: #337ab7; -webkit-box-shadow: 0 0 40px #337ab7; }
        100% { background-color: #1ab394; -webkit-box-shadow: 0 0 3px #1ab394; }
        }

        @@-moz-keyframes glowing {
        0% { background-color: #1ab394; -moz-box-shadow: 0 0 3px #1ab394; }
        50% { background-color: #337ab7; -moz-box-shadow: 0 0 40px #337ab7; }
        100% { background-color: #1ab394; -moz-box-shadow: 0 0 3px #1ab394; }
        }

        @@-o-keyframes glowing {
        0% { background-color: #1ab394; box-shadow: 0 0 3px #1ab394; }
        50% { background-color: #337ab7; box-shadow: 0 0 40px #337ab7; }
        100% { background-color: #1ab394; box-shadow: 0 0 3px #1ab394; }
        }

        @@keyframes glowing {
        0% { background-color: #1ab394; box-shadow: 0 0 3px #1ab394; }
        50% { background-color: #337ab7; box-shadow: 0 0 40px #337ab7; }
        100% { background-color: #1ab394; box-shadow: 0 0 3px #1ab394; }
        }
    </style>
}
